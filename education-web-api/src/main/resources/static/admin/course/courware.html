<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title></title>
    <link rel="stylesheet" href="../../css/new_file.css"/>
    <script type="text/javascript" src="../../common/lib/jquery-1.9.0.min.js"></script>
    <script type="text/javascript" src="../../common/js/common/map.js"></script>
    <script type="text/javascript" src="../../common/js/common/ajaxsend.js"></script>
    <script type="text/javascript" src="../../common/js/common/utils.js"></script>
    <script type="text/javascript" src="../../common/lib/ajaxfileupload.js"></script>
    <script type="text/javascript" src="../../common/js/parent.js"></script>
    <script type="text/javascript" src="../../common/js/child.js"></script>
    <script type="text/javascript" src="../../js/form_deal.js"></script>
</head>
<body>
<div class="content">
    <div class="top">
        <div class="top_w">
            <div class="blue"></div>
            <span class="sp_text">课件信息</span>
        </div>
    </div>
    <form id="resource_id" style="display: none">
        <table cellpadding="10">
            <tr>
                <th width="160" class="Ri">标题:</th>
                <th width="80" class="Le" id="resource_title">

                </th>
            </tr>
            <tr>
                <th width="160" class="Ri">资源类型:</th>
                <th width="80" class="Le" id="resource_type">
                </th>
            </tr>
            <tr>
                <th width="160" class="Ri"><span>*</span>资源内容:</th>
                <th width="380" class="Le" id="content">
                </th>
            </tr>
            <tr>
                <th colspan="1" style="text-align: left;">
                    <button type="button" class="next_page">下一页</button>
                    <button type="button" class="pre_page">上一页</button>
                    <button type="button" id="close">关闭</button>
                </th>
            </tr>
        </table>
    </form>
</div>
<script language="javascript" type="text/javascript">


    $(function () {
        function dealResource(resultItem) {
            $("#resource_id").show();
            $("#question_id").hide();
            if (resultItem.type == "IMG") {
                $("#resource_title").html(resultItem.imgWordText.title);
                $("#resource_type").html("图片")
                $("#content").html("<a target='_blank' href='" + resultItem.imgWordText.content + "'>下载图片</a>")
            } else if (resultItem.type == "VIDEO") {
                $("#resource_title").html(resultItem.videoDTO.title);
                $("#resource_type").html("视频")
                var contentHtml = "<span style='color:black'>视频内容</span><a target='_blank' href='" + resultItem.videoDTO.videoUrl + "'>下载视频</a><br/>";
                contentHtml += "<span style='color:black'>视频首页</span><a target='_blank' href='" + resultItem.videoDTO.imgUrl + "'>下载首页图片</a><br/>";
                $("#content").html(contentHtml)
            } else if (resultItem.type == "TEXT") {
                $("#resource_title").html('');
                $("#content").html(resultItem.imgWordText.content)
                $("#resource_type").html("文字")
            } else if (resultItem.type == "WORD") {
                $("#resource_title").html(resultItem.imgWordText.title);
                $("#content").html("<a target='_blank' href='" + resultItem.imgWordText.content + "'>下载文档</a>")
                $("#resource_type").html("word文档")
            } else if (resultItem.type == "BLUEPRINT") {
                $("#resource_title").html(resultItem.blueprintDetailDTO.blueprintAnswerDTO.title);
                $("#resource_type").html("图纸以及图纸答案")
            }
        }

        $("#close").click(function () {
            callParent.closeTab(Utils.getHrefValue("tab_id"))
        })
        var id = Utils.getHrefValue("id");
        var resultItemList = new Array();
        var index = -1;
        if (Utils.isNotBlack(id)) {
            ajaxget("/api/admin/course/item_info?id=" + id, function (result) {
                resultItemList = result.result;
            });
        }

        function next() {
            var resultItem = resultItemList[index + 1];
            index = index + 1;
            if (resultItem.type == "RESOURCE") {
                dealResource(resultItem)
            } else {
                dealQuestion(resultItem)
            }

            pageShow();

        }

        function pre() {
            var resultItem = resultItemList[index - 1];
            index = index - 1;
            if (resultItem.type == "RESOURCE") {
                dealResource(resultItem)
            } else {
                dealQuestion(resultItem)
            }

            pageShow();
        }

        function pageShow() {
            if (index <= 0) {
                $(".pre_page").hide();
            }
            if (index + 1 >= resultItemList.length) {
                $(".next_page").hide();
            }
        }


        function dealQuestion(resultItem) {
            $("#resource_id").hide();
            $("#question_id").show();
        }
    });

    function updateFile(id, obj, firstImg) {
        if ($.trim($(obj).val()) != "") {
            var list = new Array();
            list.push({name: "name", value: "resource"})
            updateFileAjax(id, "/api/education/common/update_file", function (result) {
                if (firstImg == "first_img") {
                    $("#url_hidden_first").val(result.result);
                    $("#first_down_id").attr("href", result.result);
                    $("#first_down_i").show();
                } else {
                    $("#url_hidden").val(result.result);
                    $("#down_id").attr("href", result.result);
                    $("#down_id").show();
                }

            }, list);
        }
    }

    function updateFileAjax(id, url, backFun, list) {
        var type = "file";          //后台接收时需要的参数名称，自定义即可
        //即input的id，用来寻找值
        var formData = new FormData();
        formData.append(type, $("#" + id)[0].files[0]);
        if (Utils.isNotNull(list)) {
            for (var i = 0; i < list.length; i++) {
                formData.append(list[i].name, list[i].value);
            }
        }//生成一对表单属性
        $.ajax({
            type: "POST",           //因为是传输文件，所以必须是post
            url: url,         //对应的后台处理类的地址
            data: formData,
            processData: false,
            contentType: false,
            success: function (data) {
                if (Utils.isNotNull(backFun)) {
                    backFun.call(this, data);
                }
            }
        });
    }

    function addPoint() {
        $("#iut").append("<input type='text' class='point' ></input>")
    }

</script>
</body>
</html>
